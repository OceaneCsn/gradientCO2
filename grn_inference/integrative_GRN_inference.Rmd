---
title: "Integrative GRN inference for the CO2 gradient dataset"
output: html_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source('../inference_functions/bRF.R')
source('../inference_functions/LASSO-D3S.R')
source('../inference_functions/evaluateNetwork.R')
source('../inference_functions/MSE.R')
```

This document demonstrates the use of the bRF and LASSO-D3S functions for integrative GRN inference.

Those functions infer the regulatory pathways of *Arabidopsis thaliana*'s roots in response CO2.

They use as inputs the expression profiles of N-responsive genes and TFBS information. 
Prior TFBS information was built by searching in the promoters of the N-responsive genes the PWM of the N-responsive regulators. 

## Data import

### Expression data

Import of the expression data and the N-responsive genes and regulators :

```{r}
load('../rdata/CO2_degs_expression.rdata')
genes <- CO2_responsive_genes$genes
tfs <- CO2_responsive_genes$tfs
counts <- CO2_responsive_genes$counts
```

### TFBS data


```{r}
load("../rdata/pwm_occurrences_CO2_response.rdata")
dim(pwm_occurrence)
```

## GRN inference


### bRf : biased Random Forests

Let's infer a GRN using bRF with $\alpha=0.8$ and $D = 0.01$.

```{r}
importances <- bRF_inference(counts, genes, tfs, alpha = 0.8, 
                             pwm_occurrence = pwm_occurrence, nCores = 40)
grn_bRF <- bRF_network(importances, density = 0.005, pwm_occurrence, genes, tfs)
head(grn_bRF); dim(grn_bRF)
```


<!-- ### LASSO-D3S : LASSO with Differential Shrinkage and Stability Selection -->

<!-- Let's infer a GRN using LASSO-D3S with $\alpha=0.8$ and $D = 0.01$. -->

<!-- ```{r} -->
<!-- pvalues <- LASSO.D3S_inference(counts, genes, tfs, alpha = 0.8, N = 50, -->
<!--                                pwm_occurrence = pwm_occurrence, nCores = 50) -->
<!-- grn_lasso.d3s <- LASSO.D3S_network(pvalues, density = 0.005, pwm_occurrence, genes, tfs) -->
<!-- head(grn_lasso.d3s); dim(grn_lasso.d3s) -->
<!-- ``` -->


### Validating the GRNs against ConnecTF

```{r}
connecTF_validation <- evaluate_networks(list("bRF" = grn_bRF), 
                  input_genes = genes, input_tfs = tfs, nCores = 10); connecTF_validation
```



### Computing prediction error

```{r}
get_MSE(grn_bRF, method = "bRF")
get_MSE(grn_lasso.d3s, method = "LASSO-D3S")
```

The error in predicting the target gene expression is however lower in LASSO-D3S.

